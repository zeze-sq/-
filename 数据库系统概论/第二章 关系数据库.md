# 第二章 关系数据库

### 2.1、关系概述

### 0.思维导图

![](imgs\关系概述.png)

#### 2.1.1、关系

现实世界的实体以及实体间的各种联系均用关系来表示。

从用户角度，关系模型中数据的逻辑结构是一张二维表，它是建立在集合代数的基础上。

> - **域（Domain）：** 域是一组具有相同数据类型的值的集合。

> - **笛卡尔积（Cartesian Product）：** 给定一组域D1，D2，…，Dn，允许其中某些域是相同的。D1，D2，…，Dn的笛卡尔积为：   		D1×D2×…×Dn ＝｛（d1，d2，…，dn）｜di∈Di，i＝1，2，…，n｝，笛卡尔积是所有域的所有取值的一个组合，它不能重复。

> - **元组（Tuple）：**笛卡尔积中每一个元素（d1，d2，…，dn）叫作一个n元组（n-tuple）或简称元组。 -  分量（Component）：笛卡尔积中每一个元素（d1，d2，…，dn）中的每一个值di叫作一个分量。 -  基数（Cardinal number）：若Di（i＝1，2，…，n）为有限集，其基数为mi（i＝1，2，…，n），则D1×D2×…×Dn的基数M为：<img src="imgs/61b3439c2989718236a9a9ea4aa48b09-1667791693225-1.png" alt="image-20201123094231714"> -  

- 表示方法：笛卡尔积可表示为一张二维表，表中的每行对应一个元组，表中的每列对应一个域。 

  > 例如，给出3个域：
  >
  > 
  >
  > D1=导师集合SUPERVISOR=｛张清玫，刘逸｝
  > D2=专业集合SPECIALITY=｛计算机专业，信息专业｝
  > D3=研究生集合POSTGRADUATE=｛李勇，刘晨，王敏｝
  > D1，D2，D3的笛卡尔积为
  > D1×D2×D3＝｛
  > (张清玫，计算机专业，李勇)，(张清玫，计算机专业，刘晨)，
  > (张清玫，计算机专业，王敏)，(张清玫，信息专业，李勇)，
  > (张清玫，信息专业，刘晨)，(张清玫，信息专业，王敏)，
  > (刘逸，计算机专业，李勇)，(刘逸，计算机专业，刘晨)，
  > (刘逸，计算机专业，王敏)，(刘逸，信息专业，李勇)，
  > (刘逸，信息专业，刘晨)，(刘逸，信息专业，王敏) ｝
  > 基数为2×2×3＝12

**关系（Relation）：** 

> D1×D2×…×Dn的子集叫作在域D1，D2，…，Dn上的关系，表示为R（D1，D2，…，Dn），其中，R为关系名，n为关系的目或度（Degree）。关系中的每个元素是关系中的元组，通常用t表示。当n=1时，称该关系为单元关系（Unary relation）或一元关系 ，当n=2时，称该关系为二元关系（Binary relation），关系也是一个二维表，表的每行对应一个元组，表的每列对应一个域，关系中不同列可以对应相同的域，为了加以区分，必须对每列起一个名字，称为属性（Attribute），n目关系必有n个属性。若关系中的某一属性组的值能唯一地标识一个元组，则称该属性组为候选码，简单的情况：候选码只包含一个属性，最极端的情况：关系模式的所有属性组是这个关系模式的候选码，称为全码（All-key），若一个关系有多个候选码，则选定其中一个为主码（Primary key），候选码的诸属性称为主属性（Prime attribute），不包含在任何侯选码中的属性称为非主属性（Non-Prime attribute）或非码属性（Non-key attribute） 。

> **三类关系**：
>
> - 基本关系（基本表或基表）：实际存在的表，是实际存储数据的逻辑表示
> - 查询表：查询结果对应的表
> - 视图表：由基本表或其他视图表导出的表，是虚表，不对应实际存储的数据
>
> **基本关系的性质**：
>
> - 列是同质的（Homogeneous）
> - 不同的列可出自同一个域，其中的每一列称为一个属性，不同的属性要给予不同的属性名
> - 列的顺序无所谓，列的次序可以任意交换
> - 行的顺序无所谓，行的次序可以任意交换
> - 任意两个元组的候选码不能相同
> - 分量必须取原子值，这是规范条件中最基本的一条

#### 2.1.2、关系模式

- **什么是关系模式？**

> 关系模式是对关系的描述。如元组集合的结构，完整性约束条件。

- **如何定义关系模式？**

> **关系模式可以形式化地表示为**：**R（U，D，DOM，F）**
> 		R       	     关系名
> 		U       	     组成该关系的属性名集合
> 		D       	     U中属性所来自的域
> 		DOM  	    属性向域的映象集合
> 		F        	     属性间数据的依赖关系的集合
> 		
> **关系模式通常可以简记为R (U)或 R (A1，A2，…，An)**
>         R: 关系名
>         A1，A2，…，An  : 属性名
> 注：域名及属性向域的映象常常直接说明为属性的类型、长度

- **关系模式与关系？**

  > 关系模式（Relation Schema）是型，而关系是值，关系模式和关系往往笼统称为关系。
  >
  > 关系模式是对关系的描述，它是静态的、稳定的。
  > 关系则表示关系模式在某一时刻的状态或内容，它是动态的、随时间不断变化的。

#### 2.1.3、关系数据库

**关系数据库：**在一个给定的应用领域中，所有关系的集合构成一个关系数据库。

**关系数据库的型与值：**

> - **关系数据库的型:** 关系数据库模式，是对关系数据库的描述。
>
> - **关系数据库的值:** 关系模式在某一时刻对应的关系的集合，通常称为关系数据库。

#### 2.1.4、关系模型的存储结构

**关系数据库的物理组织：**

> - 有的关系数据库管理系统中一个表对应一个操作系统文件，将物理数据组织交给操作系统完成。
> - 有的关系数据库管理系统从操作系统那里申请若干个大的文件，自己划分文件空间，组织表、索引等存储结构，并进行存储管理。

### 2.2、关系操作

**常用关系操作：**

> - **查询操作：**选择、投影、连接、除、并、差、交、笛卡尔积（选择、投影、并、差、笛卡尔基是5种基本操作，交、连接、除，可以用5种基本运算来表达，引进它们并不增加语言的能力，但可以简化表达）
> - **数据更新：**插入、删除、修改

> **关系操作特点：**操作的对象和结果都是集合，一次一集合的方式。
>
> **关系代数语言：**用对关系的运算来表达查询要求，代表：ISBL。
>
> **关系演算语言：**用谓词来表达查询要求。

- **元组关系演算语言：**谓词变元的基本对象是元组变量，代表：APLHA, QUEL。

- **域关系演算语言 ：**谓词变元的基本对象是域变量，代表：QBE。

  具有关系代数和关系演算双重特点的语言，代表：SQL（Structured Query Language）。

### 2.3、关系完整性

### 0.思维导图

![](imgs\关系完整性.png)

**关系的三类完整性约束：**

>- **实体完整性和参照完整性**：关系模型必须满足的完整性约束条件称为关系的两个不变性，应该由关系系统自动支持。
>- **用户定义的完整性**：应用领域需要遵循的约束条件，体现了具体领域中的语义约束。

#### 2.3.1、实体完整性

**实体完整性规则（Entity Integrity）**：若属性A是基本关系R的主属性，则属性A不能取空值，空值就是“不知道”或“不存在”或“无意义”的值。

**实体完整性规则的说明**：

> 1. 实体完整性规则是针对基本关系而言的，一个基本表通常对应现实世界的一个实体集。
> 2.  现实世界中的实体是可区分的，即它们具有某种唯一性标识。
> 3. 关系模型中以主码作为唯一性标识。
> 4. 主码中的属性即主属性不能取空值。主属性取空值，就说明存在某个不可标识的实体，即存在不可区分的实体，这与第（2）点相矛盾，因此这个规则称为实体完整性

#### 2.3.2、参照完整性
> - **关系间的引用**：在关系模型中实体及实体间的联系都是用关系来描述的，自然存在着关系与关系间的引用。
> - **外码**：设F是基本关系R的一个或一组属性，但不是关系R的码。如果F与基本关系S的主码Ks相对应，则称F是R的外码。基本关系R称为参照关系（Referencing Relation），基本关系S称为被参照关系（Referenced Relation）或目标关系（Target Relation）。-
> -  **参照完整性规则**：若属性（或属性组）F是基本关系R的外码它与基本关系S的主码Ks相对应（基本关系R和S不一定是不同的关系），则对于R中每个元组在F上的值必须为：或者取空值（F的每个属性值均为空值），或者等于S中某个元组的主码值。

#### 2.3.3、用户定义的完整性

> 针对某一具体关系数据库的约束条件，反映某一具体应用所涉及的数据必须满足的语义要求。
>
> 关系模型应提供定义和检验这类完整性的机制，以便用统一的系统的方法处理它们，而不需由应用程序承担这一功能。
>

### 2.4、关系代数

### 0.思维导图

![](imgs\关系代数.png)

> 关系代数是一种抽象的查询语言，它用对关系的运算来表达查询。
>
> 关系代数的运算对象是关系，运算结果亦为关系。
>
> 关系代数的运算符有两类：传统的集合运算符和专门的关系运算符，传统的集合运算是从关系的“水平”方向即行的角度进行，而专门的关系运算不仅涉及行而且涉及列。
>
> 常见的关系运算符如下：
>
> <img src="imgs\007f1eb6e64982c8f25646a0fb28294e.png" alt="image-20201123105448719">

#### 2.4.1、传统的集合运算符

**并：**

<img src="imgs\65e790d81b6786e5ef11ec615534d338.png" alt="image-20201123105816304">

**差：**

<img src="imgs\c8d5d63ba50cbdc8bbbe828f15a7949c.png" alt="image-20201123105851101">

**交：**

<img src="imgs\783bb973114afaf529dbea7da1c720d8.png" alt="image-20201123105930759">

**笛卡尔积：**

<img src="imgs\641e7a9e019ef7a343a4ce804dc9410f.png" alt="image-20201123110031767">

#### 2.4.2、专门的集合运算符

**选择：**

<img src="imgs\8c01a3ea7522a101f541688914559391.png" alt="image-20201123110621165">

**投影：**

<img src="imgs\fe2c01c1a83918e1f5db8680408aa5d0.png" alt="image-20201123110804174">

**连接：**

<img src="imgs\625c9755b8e7616d7da1934774e54a69.png" alt="image-20201123121805030">

**除：**

<img src="imgs\4e9f3ff6c0b77154a7799982b875e8de.png" alt="image-20201123121726738">
